<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Login — EWS</title>
  <style>
    :root{--bg:#0f1724;--card:#ffffff;--accent:#4f46e5;--muted:#6b7280;--text:#1f2937;--input-bg:#f9fafb}
    body{font-family:Inter,system-ui,Arial;background-color:#e5e7eb;color:var(--text);display:flex;align-items:center;justify-content:center;height:100vh;margin:0}
    .card{background:var(--card);padding:32px;border-radius:16px;box-shadow:0 12px 24px rgba(0,0,0,0.1);width:400px;border: 1px solid #d1d5db;text-align:center;}
    .logo{max-width:200px;margin:0 auto 20px;display:block;}
    h1{margin:0 0 20px;font-size:24px;color:var(--text);text-align:center}
    p{color:var(--muted);margin:0 0 20px}
    label{display:block;font-size:14px;font-weight: 500; margin-bottom:6px; color:var(--text);text-align:left}
    input[type=text], input[type=password]{width:100%;padding:12px;border:1px solid #d1d5db;border-radius:8px;font-size:16px;box-sizing:border-box;margin-bottom:20px;background-color:var(--input-bg);transition:border-color .2s}
    input[type=text]:focus, input[type=password]:focus{border-color:var(--accent);outline:none}
    button{width:100%;padding:12px;background-color:var(--accent);color:white;border:none;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;transition:background-color .2s}
    button:hover{background-color:#4338ca}
    .notice{padding:12px;margin-bottom:20px;border-radius:8px;font-size:14px;display:none}
    .notice.error{background-color:#fee2e2;color:#ef4444;border:1px solid #fca5a5}
  </style>
  <script>
      function checkLoginError() {
          const params = new URLSearchParams(window.location.search);
          const notice = document.getElementById('notice');
          if (params.get('error') === '1') {
              notice.innerText = 'Login failed — Invalid credentials or session expired.';
              notice.classList.add('error');
              notice.style.display = 'block';
              // Clean up the URL
              history.replaceState({}, document.title, window.location.pathname);
          }
      }
      document.addEventListener('DOMContentLoaded', checkLoginError);
  </script>
</head>
<body>
  <div class="card">
    <img src="images/bank-logo.png.jpg" alt="Bank Logo" class="logo" />
    <h1>EWS Admin Login</h1>
    <div id="notice" class="notice"></div>
    <form id="loginForm" action="/admin-login" method="POST">
      <label for="username">Username</label>
      <input type="text" id="username" name="username" required autocomplete="username" value="admin" />
      <label for="password">Password</label>
      <input type="password" id="password" name="password" required autocomplete="current-password" value="password" />
      <button type="submit">Login</button>
    </form>
  </div>
  <script>
    document.getElementById('loginForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const n = document.getElementById('notice');
      n.style.display = 'none';
      const form = e.target;
      const data = new URLSearchParams(new FormData(form));
      try {
        const res = await fetch(form.action, {
          method: 'POST',
          body: data,
          credentials: 'same-origin',
          headers: { 'Accept': 'text/html,application/xhtml+xml,application/xml' }
        });

        if (res.redirected) {
          window.location.href = res.url;
          return;
        }

        const loc = res.headers.get('location');
        if (loc) {
          window.location.href = loc;
          return;
        }

        if (res.status === 200) {
          window.location.href = '/static/bank_dashboard.html';
          return;
        }
        
        // On failure (e.g., 401 response not redirecting)
        if (res.status === 401) {
            n.innerText = 'Login failed — Invalid credentials or session expired.';
            n.classList.add('error');
            n.style.display = 'block';
            return;
        }

        n.innerText = 'Login failed — please try again.';
        n.classList.add('error');
        n.style.display = 'block';

      } catch (err) {
        n.innerText = 'An error occurred during login. Check server connection.';
        n.classList.add('error');
        n.style.display = 'block';
      }
    });
  </script>
</body>
</html>