<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Login â€” EWS</title>
  <style>
    :root{--bg:#0f1724;--card:#ffffff;--accent:#4f46e5;--muted:#6b7280;--text:#1f2937;--input-bg:#f9fafb}
    body{font-family:Inter,system-ui,Arial;background-color:#e5e7eb;color:var(--text);display:flex;align-items:center;justify-content:center;height:100vh;margin:0}
    .card{background:var(--card);padding:32px;border-radius:16px;box-shadow:0 12px 24px rgba(0,0,0,0.1);width:400px;border: 1px solid #d1d5db;}
    h1{margin:0 0 8px;font-size:24px;color:var(--text)}
    p{color:var(--muted);margin:0 0 20px}
    label{display:block;font-size:14px;font-weight: 500; margin-bottom:6px; color:var(--text)}
    input[type=text], input[type=password]{width:100%;padding:12px;border-radius:8px;border:1px solid #d1d5db;background:var(--input-bg);color:var(--text);margin-bottom:16px; transition: border-color 0.2s}
    input[type=text]:focus, input[type=password]:focus{border-color:var(--accent); outline: none;}
    .row{display:flex;gap:10px; justify-content: center;}
    .btn{background:var(--accent);border:none;color:#fff;padding:12px 18px;border-radius:8px;cursor:pointer;font-weight: 600; transition: background-color 0.2s;}
    .btn:hover{background:#4338ca;}
    .small{font-size:12px;color:var(--muted);margin-top:16px}
    .notice{background:#fef3c7;padding:10px;border-radius:8px;margin-bottom:16px; color:#92400e; border: 1px solid #fcd34d;}
    a{color:var(--accent); text-decoration: none; transition: color 0.2s;}
    a:hover{color:#4338ca;}
    .password-reset { text-align: center; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="card">
    <div style="text-align:center; margin-bottom: 24px;">
      <div style="font-size:32px; color:var(--accent); margin-bottom: 8px;">ðŸ”’</div>
      <h1>Admin Portal Login</h1>
      <div style="color:var(--muted);font-size:14px">Access system exports and operational tools.</div>
    </div>

    <div id="notice" class="notice" style="display:none;color:#92400e"></div>

    <form id="loginForm" method="post" action="/admin-login" style="margin-top:14px">
      <label for="username">Username</label>
      <input id="username" name="username" type="text" autocomplete="username" required />
      <label for="password">Password</label>
      <input id="password" name="password" type="password" autocomplete="current-password" required />
      <div class="row" style="margin-top:8px"><button class="btn" type="submit">Sign in</button></div>
    </form>

    <div class="password-reset">
      <a href="#" id="resetPasswordLink">Forgot Password?</a>
    </div>
    <div id="resetMessage" class="notice" style="display:none;margin-top:10px;"></div>

    <div class="small" style="margin-top:24px">Default credentials are read from environment variables <code>ADMIN_USERNAME</code> and <code>ADMIN_PASSWORD</code>.</div>
    <div class="small" style="margin-top:6px">Or <a href="/static/bank_dashboard.html">view dashboard</a> (requires login for admin features).</div>
  </div>

  <script>
    // Show error message if redirected with failed=1
    const params = new URLSearchParams(window.location.search);
    if (params.get('failed') === '1') {
      const n = document.getElementById('notice');
      n.innerText = 'Login failed â€” invalid credentials.';
      n.style.display = 'block';
    }

    // Password reset functionality
    document.getElementById('resetPasswordLink').addEventListener('click', function(e) {
      e.preventDefault();
      const messageDiv = document.getElementById('resetMessage');
      messageDiv.style.display = 'block';
      messageDiv.innerText = 'Password reset instructions would be sent to your registered email address in a production environment.';
      messageDiv.style.color = '#059669'; // green-600
      
      // Hide the message after 5 seconds
      setTimeout(() => {
        messageDiv.style.display = 'none';
      }, 5000);
    });

    // Submit form via fetch to make redirect behavior explicit and handle cookies/feedback
    document.getElementById('loginForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const n = document.getElementById('notice');
      n.style.display = 'none';
      const form = e.target;
      const data = new URLSearchParams(new FormData(form));
      try {
        const res = await fetch(form.action, {
          method: 'POST',
          body: data,
          credentials: 'same-origin',
          headers: { 'Accept': 'text/html,application/xhtml+xml,application/xml' }
        });

        // If server responds with redirect, follow it explicitly.
        if (res.redirected) {
          window.location.href = res.url;
          return;
        }

        // Some servers return 302 without flagged 'redirected' for fetch; check headers
        const loc = res.headers.get('location');
        if (loc) {
          window.location.href = loc;
          return;
        }

        if (res.status === 200) {
          // Loaded HTML (unlikely for login success) â€” navigate to dashboard anyway
          window.location.href = '/static/bank_dashboard.html';
          return;
        }

        // On failure, show message
        n.innerText = 'Login failed â€” please try again.';
        n.style.display = 'block';

      } catch (err) {
        n.innerText = 'Network error â€” check that the server is running.';
        n.style.display = 'block';
      }
    });
  </script>
</body>
</html>